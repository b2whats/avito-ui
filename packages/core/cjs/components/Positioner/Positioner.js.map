{"version":3,"sources":["../../../src/components/Positioner/Positioner.tsx"],"names":["getModifiers","minWidth","width","maxWidth","props","modifiersName","modifiers","customApplyStyles","targetWidth","forEach","name","push","enabled","Boolean","options","undefined","Positioner","positionerTheme","theme","open","localOpen","setLocalOpen","targetRef","referenceRef","toggleTimerId","strategy","placement","offset","arrow","hide","flip","preventOverflow","handleToggle","toggle","clearTimeout","current","setTimeout","onOpen","onClose","delayIn","delayOut","target","reference","style","margin","popper","destroy","usePortal","handleScroll","handleСlick","handlePressEsc","event","key","handleOutsideClick","contains","closeOnOutsideClick","document","addEventListener","closeOnClick","closeOnScroll","closeOnEsc","removeEventListener","Children","only","children","eventHandlers","aria","trigger","onClick","onFocus","onBlur","onMouseEnter","onMouseLeave","tabIndex","animation","transitions","close","item"],"mappings":"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","sourcesContent":["import { createPopper, StrictModifiers } from '@popperjs/core'\nimport React, { useRef, useState, useMemo, useCallback, useEffect, Children, cloneElement, HTMLAttributes } from 'react'\nimport { animated, Transition } from 'react-spring'\nimport { useIsomorphicLayoutEffect } from '../../hooks/'\nimport { uiComponent } from '../../theme/'\nimport { invokeAll } from '../../utils/'\nimport { NodeResolver } from '../NodeResolver/'\nimport { Portal } from '../Portal/'\nimport { PositionerProps } from './contract'\nimport { targetWidth, customApplyStyles, TargetWidthModifier } from './modifiers/'\nimport { positionerTheme } from './theme'\n\nconst getModifiers = ({ minWidth, width, maxWidth, ...props}: Partial<PositionerProps>) => {\n  const modifiersName = ['offset', 'arrow', 'flip', 'preventOverflow', 'hide'] as const\n  const modifiers: (StrictModifiers | Partial<TargetWidthModifier>)[] = [customApplyStyles, targetWidth]\n\n  modifiersName.forEach(name => {\n    if (name in props) {\n      modifiers.push({ name, enabled: Boolean(props[name]), options: props[name] || undefined })\n    }\n  })\n\n  if (minWidth || width || maxWidth) {\n    modifiers.push({ name: 'targetWidth', enabled: true, options: { minWidth, width, maxWidth } })\n  }\n\n  return modifiers\n}\n\nexport const Positioner = uiComponent('Positioner', positionerTheme)((props: PositionerProps, { theme }) => {\n  const [localOpen, setLocalOpen] = useState(Boolean(props.open))\n  const targetRef = useRef<HTMLDivElement | null>(null)\n  const referenceRef = useRef<HTMLElement | null>(null)\n  const toggleTimerId = useRef<number>()\n\n  const options = useMemo(() => ({\n    strategy: props.strategy,\n    placement: props.placement,\n    modifiers: getModifiers(props),\n  }), [\n    props.placement,\n    props.strategy,\n    props.offset,\n    props.arrow,\n    props.hide,\n    props.flip,\n    props.preventOverflow,\n    props.minWidth,\n    props.width,\n    props.maxWidth,\n  ])\n\n  const handleToggle = useCallback((toggle: boolean) => {\n    clearTimeout(toggleTimerId.current)\n\n    toggleTimerId.current = setTimeout(() => {\n      setLocalOpen(toggle)\n\n      toggle\n        ? props.onOpen && props.onOpen()\n        : props.onClose && props.onClose()\n    }, toggle ? props.delayIn : props.delayOut)\n\n  }, [props.delayIn, props.delayOut, props.onClose, props.onOpen])\n\n  // Обрабатываем внещний стейт open\n  useIsomorphicLayoutEffect(() => {\n    if (props.open === undefined || props.open === localOpen) return\n\n    handleToggle(props.open)\n  }, [props.open])\n\n  // Создаем инстанс popper\n  useIsomorphicLayoutEffect(() => {\n    const target = targetRef.current\n    const reference = referenceRef.current\n\n    if (!reference || !target) return\n\n    target.style.margin = '0px'\n    const popper = createPopper(reference, target, options)\n\n    return () => {\n      popper.destroy()\n    }\n  }, [localOpen, options, props.usePortal])\n\n  // Устанавливаем глобальный обрабочики при открытии\n  useEffect(() => {\n    const target = targetRef.current\n    const reference = referenceRef.current\n\n    if (!reference || !target) return\n\n    const handleScroll = () => handleToggle(false)\n    const handleСlick = () => handleToggle(false)\n    const handlePressEsc = (event: KeyboardEvent) => event.key === 'Escape' && handleToggle(false)\n    const handleOutsideClick = (event: MouseEvent) => {\n      if (target.contains(event.target as Node) || reference.contains(event.target as Node)) return\n\n      handleToggle(false)\n    }\n\n    props.closeOnOutsideClick && document.addEventListener('click', handleOutsideClick, true)\n    props.closeOnClick && document.addEventListener('click', handleСlick)\n    props.closeOnScroll && document.addEventListener('scroll', handleScroll)\n    props.closeOnEsc && document.addEventListener('keydown', handlePressEsc)\n    return () => {\n      props.closeOnOutsideClick && document.removeEventListener('click', handleOutsideClick, true)\n      props.closeOnClick && document.removeEventListener('click', handleСlick)\n      props.closeOnScroll && document.removeEventListener('scroll', handleScroll)\n      props.closeOnEsc && document.removeEventListener('keydown', handlePressEsc)\n\n    }\n  }, [localOpen, handleToggle, props.closeOnOutsideClick, props.closeOnScroll, props.closeOnEsc])\n\n  const reference = Children.only(props.children)\n\n  let eventHandlers = {}\n  let aria: HTMLAttributes<HTMLElement> = {\n    'aria-haspopup': true,\n    'aria-expanded': localOpen,\n  }\n\n  if (props.trigger === 'click') {\n    eventHandlers = {\n      onClick: invokeAll(reference.props.onClick, () => handleToggle(!localOpen)),\n    }\n  }\n\n  if (props.trigger === 'hover') {\n    eventHandlers = {\n      onFocus: invokeAll(reference.props.onFocus, () => handleToggle(true)),\n      onBlur: invokeAll(reference.props.onBlur, () => handleToggle(false)),\n      onMouseEnter: invokeAll(reference.props.onMouseEnter, () => handleToggle(true)),\n      onMouseLeave: invokeAll(reference.props.onMouseLeave, () => handleToggle(false)),\n    }\n\n    aria.tabIndex = 0\n  }\n\n  const animation = typeof props.animation === 'string' ? theme.transitions[props.animation] : props.animation\n  const target = typeof props.target === 'function' ? props.target({ close: () => handleToggle(false) }) : props.target\n\n  return (\n    <React.Fragment>\n      <NodeResolver ref={referenceRef}>\n        {cloneElement(reference, {\n          ...aria,\n          ...eventHandlers,\n        })}\n      </NodeResolver>\n      <Portal active={Boolean(props.usePortal)}>\n        <Transition items={localOpen} {...animation}>\n          {(style, item) => item && <animated.div ref={targetRef} style={style}>{target}</animated.div>}\n        </Transition>\n      </Portal>\n    </React.Fragment>\n  )\n})\n"],"file":"Positioner.js"}