{"version":3,"sources":["../../../src/components/Positioner/Positioner.tsx"],"names":["createPopper","React","useRef","useState","useMemo","useCallback","useEffect","Children","cloneElement","animated","Transition","useIsomorphicLayoutEffect","uiComponent","invokeAll","NodeResolver","Portal","targetWidth","customApplyStyles","positionerTheme","getModifiers","minWidth","width","maxWidth","props","modifiersName","modifiers","forEach","name","push","enabled","Boolean","options","undefined","Positioner","theme","open","localOpen","setLocalOpen","targetRef","referenceRef","toggleTimerId","strategy","placement","offset","arrow","hide","flip","preventOverflow","handleToggle","toggle","clearTimeout","current","setTimeout","onOpen","onClose","delayIn","delayOut","target","reference","style","margin","popper","destroy","usePortal","handleScroll","handleСlick","handlePressEsc","event","key","handleOutsideClick","contains","closeOnOutsideClick","document","addEventListener","closeOnClick","closeOnScroll","closeOnEsc","removeEventListener","only","children","eventHandlers","aria","trigger","onClick","onFocus","onBlur","onMouseEnter","onMouseLeave","tabIndex","animation","transitions","close","item"],"mappings":"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","sourcesContent":["import { createPopper, StrictModifiers } from '@popperjs/core'\nimport React, { useRef, useState, useMemo, useCallback, useEffect, Children, cloneElement, HTMLAttributes } from 'react'\nimport { animated, Transition } from 'react-spring'\nimport { useIsomorphicLayoutEffect } from '../../hooks/'\nimport { uiComponent } from '../../theme/'\nimport { invokeAll } from '../../utils/'\nimport { NodeResolver } from '../NodeResolver/'\nimport { Portal } from '../Portal/'\nimport { PositionerProps } from './contract'\nimport { targetWidth, customApplyStyles, TargetWidthModifier } from './modifiers/'\nimport { positionerTheme } from './theme'\n\nconst getModifiers = ({ minWidth, width, maxWidth, ...props}: Partial<PositionerProps>) => {\n  const modifiersName = ['offset', 'arrow', 'flip', 'preventOverflow', 'hide'] as const\n  const modifiers: (StrictModifiers | Partial<TargetWidthModifier>)[] = [customApplyStyles, targetWidth]\n\n  modifiersName.forEach(name => {\n    if (name in props) {\n      modifiers.push({ name, enabled: Boolean(props[name]), options: props[name] || undefined })\n    }\n  })\n\n  if (minWidth || width || maxWidth) {\n    modifiers.push({ name: 'targetWidth', enabled: true, options: { minWidth, width, maxWidth } })\n  }\n\n  return modifiers\n}\n\nexport const Positioner = uiComponent('Positioner', positionerTheme)((props: PositionerProps, { theme }) => {\n  const [localOpen, setLocalOpen] = useState(Boolean(props.open))\n  const targetRef = useRef<HTMLDivElement | null>(null)\n  const referenceRef = useRef<HTMLElement | null>(null)\n  const toggleTimerId = useRef<number>()\n\n  const options = useMemo(() => ({\n    strategy: props.strategy,\n    placement: props.placement,\n    modifiers: getModifiers(props),\n  }), [\n    props.placement,\n    props.strategy,\n    props.offset,\n    props.arrow,\n    props.hide,\n    props.flip,\n    props.preventOverflow,\n    props.minWidth,\n    props.width,\n    props.maxWidth,\n  ])\n\n  const handleToggle = useCallback((toggle: boolean) => {\n    clearTimeout(toggleTimerId.current)\n\n    toggleTimerId.current = setTimeout(() => {\n      setLocalOpen(toggle)\n\n      toggle\n        ? props.onOpen && props.onOpen()\n        : props.onClose && props.onClose()\n    }, toggle ? props.delayIn : props.delayOut)\n\n  }, [props.delayIn, props.delayOut, props.onClose, props.onOpen])\n\n  // Обрабатываем внещний стейт open\n  useIsomorphicLayoutEffect(() => {\n    if (props.open === undefined || props.open === localOpen) return\n\n    handleToggle(props.open)\n  }, [props.open])\n\n  // Создаем инстанс popper\n  useIsomorphicLayoutEffect(() => {\n    const target = targetRef.current\n    const reference = referenceRef.current\n\n    if (!reference || !target) return\n\n    target.style.margin = '0px'\n    const popper = createPopper(reference, target, options)\n\n    return () => {\n      popper.destroy()\n    }\n  }, [localOpen, options, props.usePortal])\n\n  // Устанавливаем глобальный обрабочики при открытии\n  useEffect(() => {\n    const target = targetRef.current\n    const reference = referenceRef.current\n\n    if (!reference || !target) return\n\n    const handleScroll = () => handleToggle(false)\n    const handleСlick = () => handleToggle(false)\n    const handlePressEsc = (event: KeyboardEvent) => event.key === 'Escape' && handleToggle(false)\n    const handleOutsideClick = (event: MouseEvent) => {\n      if (target.contains(event.target as Node) || reference.contains(event.target as Node)) return\n\n      handleToggle(false)\n    }\n\n    props.closeOnOutsideClick && document.addEventListener('click', handleOutsideClick, true)\n    props.closeOnClick && document.addEventListener('click', handleСlick)\n    props.closeOnScroll && document.addEventListener('scroll', handleScroll)\n    props.closeOnEsc && document.addEventListener('keydown', handlePressEsc)\n    return () => {\n      props.closeOnOutsideClick && document.removeEventListener('click', handleOutsideClick, true)\n      props.closeOnClick && document.removeEventListener('click', handleСlick)\n      props.closeOnScroll && document.removeEventListener('scroll', handleScroll)\n      props.closeOnEsc && document.removeEventListener('keydown', handlePressEsc)\n\n    }\n  }, [localOpen, handleToggle, props.closeOnOutsideClick, props.closeOnScroll, props.closeOnEsc])\n\n  const reference = Children.only(props.children)\n\n  let eventHandlers = {}\n  let aria: HTMLAttributes<HTMLElement> = {\n    'aria-haspopup': true,\n    'aria-expanded': localOpen,\n  }\n\n  if (props.trigger === 'click') {\n    eventHandlers = {\n      onClick: invokeAll(reference.props.onClick, () => handleToggle(!localOpen)),\n    }\n  }\n\n  if (props.trigger === 'hover') {\n    eventHandlers = {\n      onFocus: invokeAll(reference.props.onFocus, () => handleToggle(true)),\n      onBlur: invokeAll(reference.props.onBlur, () => handleToggle(false)),\n      onMouseEnter: invokeAll(reference.props.onMouseEnter, () => handleToggle(true)),\n      onMouseLeave: invokeAll(reference.props.onMouseLeave, () => handleToggle(false)),\n    }\n\n    aria.tabIndex = 0\n  }\n\n  const animation = typeof props.animation === 'string' ? theme.transitions[props.animation] : props.animation\n  const target = typeof props.target === 'function' ? props.target({ close: () => handleToggle(false) }) : props.target\n\n  return (\n    <React.Fragment>\n      <NodeResolver ref={referenceRef}>\n        {cloneElement(reference, {\n          ...aria,\n          ...eventHandlers,\n        })}\n      </NodeResolver>\n      <Portal active={Boolean(props.usePortal)}>\n        <Transition items={localOpen} {...animation}>\n          {(style, item) => item && <animated.div ref={targetRef} style={style}>{target}</animated.div>}\n        </Transition>\n      </Portal>\n    </React.Fragment>\n  )\n})\n"],"file":"Positioner.js"}